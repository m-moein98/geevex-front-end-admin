<div class="screen-90">
  <nb-card>
    <nb-card-header>
      <h5>Manage Deposit Networks for {{ rowData?.symbol }}</h5>
    </nb-card-header>

    <nb-card-body>
      <!-- Existing Networks Table -->
      <div class="mb-4">
        <h6>Existing Deposit Networks</h6>
        <div *ngIf="!isLoading; else loading">
          <div *ngIf="depositNetworks.length > 0; else noNetworks">
            <table class="table table-striped">
              <thead>
                <tr>
                  <th>Type</th>
                  <th>Network</th>
                  <th>Address</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let network of depositNetworks">
                  <td>{{ network.type }}</td>
                  <td>{{ network.network }}</td>
                  <td>{{ network.address }}</td>
                  <td>
                    <span class="badge" [class]="network.is_active ? 'badge-success' : 'badge-danger'">
                      {{ network.is_active ? 'Active' : 'Inactive' }}
                    </span>
                  </td>
                  <td>
                    <button nbButton size="tiny" status="primary" (click)="onEdit(network)">
                      <nb-icon icon="edit-outline"></nb-icon>
                    </button>
                    <button nbButton size="tiny" status="danger" (click)="onDelete(network.id)">
                      <nb-icon icon="trash-2-outline"></nb-icon>
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <ng-template #noNetworks>
            <p class="text-muted">No deposit networks found for this coin.</p>
          </ng-template>
        </div>
        <ng-template #loading>
          <div class="text-center py-3">
            <nb-spinner></nb-spinner>
          </div>
        </ng-template>
      </div>

      <!-- Add/Edit Form -->
      <div class="border-top pt-3">
        <h6>{{ isEditing ? 'Edit' : 'Add New' }} Deposit Network</h6>
        <form [formGroup]="form" (ngSubmit)="onSubmit()">
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="label" for="coin_id">Coin</label>
              <input
                nbInput
                fullWidth
                list="coinList"
                placeholder="Select coin"
                [value]="getCoinDisplay(form.get('coin_id').value)"
                (input)="onCoinInput($event)"
              />
              <datalist id="coinList">
                <option *ngFor="let coin of coins" [value]="coin.symbol + ' - ' + coin.name"></option>
              </datalist>
            </div>
            <div class="col-md-6 mb-3">
              <label class="label" for="type">Type</label>
              <nb-select
                id="type"
                fullWidth
                placeholder="Select deposit type"
                formControlName="type"
              >
                <nb-option value="CRYPTO">Crypto</nb-option>
                <nb-option value="CARD_PAYMENT">Card Payment</nb-option>
                <nb-option value="IBAN_PAYMENT">IBAN Payment</nb-option>
                <nb-option value="SHETAB_PAYMENT">SHETAB Payment</nb-option>
              </nb-select>
            </div>
            <div class="col-md-6 mb-3">
              <label class="label" for="network">Network</label>
              <input
                id="network"
                nbInput
                fullWidth
                placeholder="Enter network name"
                formControlName="network"
              />
            </div>
          </div>
          <div class="row">
            <div class="col-md-8 mb-3">
              <label class="label" for="address">Address</label>
              <input
                id="address"
                nbInput
                fullWidth
                placeholder="Enter deposit address"
                formControlName="address"
              />
            </div>
            <div class="col-md-4 mb-3">
              <label class="label" for="is_active">Status</label>
              <nb-select
                id="is_active"
                fullWidth
                placeholder="Select status"
                formControlName="is_active"
              >
                <nb-option [value]="true">Active</nb-option>
                <nb-option [value]="false">Inactive</nb-option>
              </nb-select>
            </div>
          </div>

          <div class="mt-3">
            <button nbButton status="success" type="submit" [disabled]="form.invalid || isSubmitting">
              <nb-icon icon="checkmark-outline"></nb-icon>
              <span *ngIf="!isSubmitting">{{ isEditing ? 'Update' : 'Create' }}</span>
              <span *ngIf="isSubmitting">{{ isEditing ? 'Updating...' : 'Creating...' }}</span>
            </button>

            <button nbButton status="basic" class="ml-2" (click)="onCancel()" [disabled]="isSubmitting">
              <nb-icon icon="close-outline"></nb-icon>
              Cancel
            </button>

            <button *ngIf="!isEditing" nbButton status="info" class="ml-2" (click)="onCreateNew()">
              <nb-icon icon="plus-outline"></nb-icon>
              Reset Form
            </button>
          </div>
        </form>
      </div>
    </nb-card-body>

    <nb-card-footer>
      <button nbButton status="primary" (click)="close()">Close</button>
    </nb-card-footer>
  </nb-card>
</div>